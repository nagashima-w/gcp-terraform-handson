# 3.Cloud Runをデプロイしてみる

ここでは、Terraformを使ってCloud Runをデプロイする方法について学びます

## 1.Cloud Runとは

そもそもCloud Runってなんだよ、という疑問があるかもしれませんので、簡単に説明します

- GCPのマネージドKnativeで、0〜のスケールが可能なサーバーレスコンピューティングのサービスです
  - 0〜のスケールが可能というのは、アクセスが無くなってしばらくするとコンテナが停止するからです
    - アクセスがあった場合にまたコンテナが起動します
  - 課金はコンテナの起動時間によって発生しますので、アクセスがない時間は料金が発生しません
- ステートレスかつwebアクセスが可能なコンテナをデプロイして使います
  - コンテナが停止する可能性がある以上、ステートフルではいけません

### Knativeとは

Cloud Runの説明の中でKnativeという名前が出てきましたので、こちらも簡単に説明します

- kubernetes上でコンテナをデプロイできるサーバーレスコンピューティングのツールです
- Cloud Runと違って、自前で利用するためにはkubernetesを自分たちで構築し、その上でKnativeが使えるようにする必要があります

## 2.Terraformでデプロイしてみる

- では実際にTerraformで書いてデプロイしてみましょう
- 今回はアクセス制限をしない形で、Nginxコンテナをデプロイしてみてください
- 公式のリファレンスは[こちら](https://www.terraform.io/docs/providers/google/r/cloud_run_service.html)です
- 今回も記述例は`cloud-run.tf.example`ファイルにあります
  - **課金管理のため、compute instanceのラベルは必ず付け替えてください**

### デプロイ

- 作成ができたら、先程と同様にinit〜applyまでを実行してみてください
- 問題なくデプロイできたら、ブラウザからアクセスしてみましょう
- 確認ができたら、これも先程と同様に削除してしまいましょう

## 3.リソースの削除

確認ができたら、今回作成したリソースもdestroyコマンドで削除してしまいましょう
