# 1.シンプルにVMインスタンスを1台だけ構築してみる

ここでは、最低限のTerraformファイルを作成してデプロイする方法を学びます

## 1.テンプレートを作成する書く前に

何を書けばいいの？という説明です

### プロバイダーを定義する

- Terraformを実行するにあたり、絶対に必要なパラメーターの設定です
- 必ず以下を定義します
  - GCPのAPIを叩くためのクレデンシャル
    - `file()`のカッコの中にクレデンシャルのファイルパスを書きます
    - そうすることで、ファイルの中身を展開した状態でTerraformが読み込んでくれます
  - TerraformでリソースをデプロイするGCPプロジェクトのID
- regionは必須ではありませんが、どこのリージョンにデプロイされるのかが明確になるので、基本的に指定しておいたほうが無難です

```hcl
provider "google" {
  credentials = file(path/to/credential)
  project     = project id
  region      = region
}
```

### 変数を入れる

これから実行してもらうテンプレートには変数があるため、それに代入するためのファイルを作成します

- `vm/`に移動
- `vim terraform.tfvars`

以下の内容を入力してください

```txt
CREDENTIAL = "クレデンシャルファイルのパス"
PROJECT    = "Terraformでリソースを操作するプロジェクトのID"
REGION     = "asia-northeast1"
ZONE       = "asia-northeast1-b"
```

## 2. terraformコマンドを実行してみる

いきなり書けと言われても同しようもないと思うので、とりあえずterraformコマンドを実行してみましょう

- `terraform init`
  - このコマンドでイニシャライズが実行され、プロバイダーに応じたモジュールがインストールされます
- `terraform plan`
  - このコマンドでは、TerraformのDry-Run（実際にデプロイしたらどうなるかの確認）が可能です
  - また、構文に問題があった場合はここでエラーが発生します
- `terraform apply`
  - 実際にリソースをデプロイするためのコマンドです
  - `plan`のときにエラーが出なくても、ここでエラーが発生する場合があります
    - その場合は対応してから再度コマンドを実行しましょう

### 3.GCPのコンソールでリソースがデプロイされていることを確認してみる

GCPのwebコンソールからVMインスタンスが作成されていることを確認してみましょう
